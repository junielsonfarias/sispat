================================================================================
  COMANDOS PARA DEPLOY EM PRODU√á√ÉO - CORRE√á√ïES SETORES E INVENT√ÅRIO
================================================================================

üìÖ Data: 14/10/2025
üîó Commit: 5693c40
üìù Corre√ß√µes: Filtro de setores + Erro 400 invent√°rio

================================================================================
  OP√á√ÉO 1: SCRIPT AUTOM√ÅTICO (RECOMENDADO)
================================================================================

Execute NO SERVIDOR:

cd /var/www/sispat
wget https://raw.githubusercontent.com/junielsonfarias/sispat/main/DEPLOY_PRODUCAO_CORRECOES.sh
chmod +x DEPLOY_PRODUCAO_CORRECOES.sh
./DEPLOY_PRODUCAO_CORRECOES.sh


================================================================================
  OP√á√ÉO 2: COMANDOS MANUAIS
================================================================================

1Ô∏è‚É£ NAVEGUE PARA O DIRET√ìRIO DO PROJETO
----------------------------------------
cd /var/www/sispat


2Ô∏è‚É£ FA√áA BACKUP DO SISTEMA ATUAL
----------------------------------------
mkdir -p backup_$(date +%Y%m%d_%H%M%S)
cp -r dist backup_$(date +%Y%m%d_%H%M%S)/dist_backup
cp -r backend/dist backup_$(date +%Y%m%d_%H%M%S)/backend_dist_backup


3Ô∏è‚É£ ATUALIZE O C√ìDIGO
----------------------------------------
# Backup dos arquivos .env
cp .env .env.backup
cp backend/.env backend/.env.backup

# Pull do reposit√≥rio
git fetch origin
git pull origin main

# Restaurar .env
cp .env.backup .env
cp backend/.env.backup backend/.env


4Ô∏è‚É£ COMPILE O FRONTEND
----------------------------------------
# Instalar depend√™ncias (se necess√°rio)
npm install --legacy-peer-deps --production=false

# Remover build anterior
rm -rf dist

# Compilar
npm run build

# Verificar se compilou
ls -la dist/


5Ô∏è‚É£ COMPILE O BACKEND
----------------------------------------
cd backend

# Instalar depend√™ncias (se necess√°rio)
npm install --production=false

# Remover build anterior
rm -rf dist

# Compilar
npm run build

# Verificar se compilou
ls -la dist/

cd ..


6Ô∏è‚É£ REINICIE OS SERVI√áOS
----------------------------------------
# Reiniciar backend
pm2 restart sispat-backend

# Aguardar 3 segundos
sleep 3

# Recarregar Nginx
sudo systemctl reload nginx


7Ô∏è‚É£ VERIFIQUE O DEPLOY
----------------------------------------
# Status do PM2
pm2 list

# Status do Nginx
sudo systemctl status nginx

# Logs do backend (√∫ltimas 50 linhas)
pm2 logs sispat-backend --lines 50


================================================================================
  TESTES P√ìS-DEPLOY
================================================================================

‚úÖ TESTE 1: USU√ÅRIO NORMAL
--------------------------
1. Fa√ßa login como USU√ÅRIO (n√£o admin/supervisor)
2. V√° em "Gerar Invent√°rio"
3. ‚úÖ Deve ver APENAS os setores atribu√≠dos a voc√™
4. V√° em "Gerar Relat√≥rio"
5. ‚úÖ Deve ver APENAS os setores atribu√≠dos a voc√™


‚úÖ TESTE 2: SUPERVISOR
--------------------------
1. Fa√ßa login como SUPERVISOR
   Email: supervisor@ssbv.com
   Senha: Master6273@
2. V√° em "Gerar Invent√°rio"
3. ‚úÖ Deve ver TODOS os setores
4. ‚úÖ Deve conseguir selecionar setor espec√≠fico
5. V√° em "Gerar Relat√≥rio"
6. ‚úÖ Deve ver TODOS os setores


‚úÖ TESTE 3: CRIAR INVENT√ÅRIO
--------------------------
1. Fa√ßa login como USU√ÅRIO ou SUPERVISOR
2. V√° em "Gerar Invent√°rio"
3. Preencha o formul√°rio:
   - Nome: Invent√°rio Teste
   - Setor: [Selecione um setor]
   - Escopo: Setor Completo
4. Clique em "Criar Invent√°rio"
5. ‚úÖ N√ÉO deve dar erro 400
6. ‚úÖ Invent√°rio deve ser criado com sucesso


================================================================================
  MONITORAMENTO
================================================================================

üìä VER LOGS EM TEMPO REAL:
pm2 logs sispat-backend

üìä VER √öLTIMAS 100 LINHAS:
pm2 logs sispat-backend --lines 100 --nostream

üìä VER APENAS ERROS:
pm2 logs sispat-backend --err

üìä STATUS DOS SERVI√áOS:
pm2 status
sudo systemctl status nginx


================================================================================
  ROLLBACK (EM CASO DE PROBLEMA)
================================================================================

Se algo der errado, voc√™ pode restaurar o backup:

# Encontrar o backup
ls -la | grep backup_

# Restaurar (substitua XXXXX pelo nome do backup)
cp -r backup_XXXXX/dist_backup dist
cp -r backup_XXXXX/backend_dist_backup backend/dist

# Reiniciar servi√ßos
pm2 restart sispat-backend
sudo systemctl reload nginx


================================================================================
  DOCUMENTA√á√ÉO
================================================================================

üìÑ Documenta√ß√£o completa: CORRECOES_SETORES_E_INVENTARIO.md
üîó Commit: https://github.com/junielsonfarias/sispat/commit/5693c40


================================================================================
  SUPORTE
================================================================================

Se encontrar problemas:
1. Verifique os logs: pm2 logs sispat-backend --lines 100
2. Verifique o console do navegador (F12)
3. Limpe o cache do navegador (Ctrl+Shift+Delete)
4. Tente em uma aba an√¥nima


================================================================================
  ‚úÖ CHECKLIST DE DEPLOY
================================================================================

[ ] Navegou para /var/www/sispat
[ ] Fez backup do sistema atual
[ ] Fez git pull origin main
[ ] Compilou o frontend (npm run build)
[ ] Compilou o backend (cd backend && npm run build)
[ ] Reiniciou o backend (pm2 restart sispat-backend)
[ ] Recarregou o Nginx (sudo systemctl reload nginx)
[ ] Verificou os logs (pm2 logs sispat-backend --lines 50)
[ ] Testou com usu√°rio normal
[ ] Testou com supervisor
[ ] Testou criar invent√°rio


================================================================================
  üéâ FIM
================================================================================

